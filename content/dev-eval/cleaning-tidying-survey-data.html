---
title: "Cleaning and Tidying Survey Data"
author: "Corey Pembleton"
date: "December 2, 2018"
output: html_document
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<div id="working-with-survey-data-processing-for-use-and-visualization" class="section level2">
<h2>Working with Survey Data: Processing for Use and Visualization</h2>
<p>Depending on the survey software used, the results exported as excel or .csv can often be fairly messy, and processing that data manually in excel can be time consuming and is prone to copy/paste or other munging errors. Using a real example (questions and stakeholder names changed), I present here one fairly replicable way to process survey data exported from SurveyMonkey. I should note here that I didn’t design this survey, there are several methodological flaws regarding response options and questions themselves, but that conversation is for another day.</p>
</div>
<div id="three-challenges-with-survey-data" class="section level2">
<h2>Three Challenges with Survey Data</h2>
<pre class="r"><code>survey &lt;- read_excel(&quot;./anon_survey.xlsx&quot;)</code></pre>
<div id="multiple-header-rows" class="section level4">
<h4>1. Multiple header rows</h4>
<p>SurveyMonkey results are exported with two or more header rows. The first row is descriptive, for “parent” main questions, the second for the “child” subquestions, the data required is stored in the latter.</p>
<p>In addition to Questions, the first 1-10 columns contain descriptive information on the respondent, and other descriptive elements. These descriptive aspects are stored in the first row (along with the parent questions), which <code>read_excel()</code> correctly sets as the header.</p>
<div class="figure">
<img src="/img/messy_survey.png" alt="Getting the import right is half the battle" />
<p class="caption">Getting the import right is half the battle</p>
</div>
<p>Because of this structure, <code>name()</code> can’t be set on import, and some manipulation is required. This method, which I’ve taken from <a href="%22https://debruine.github.io/multirow_headers.html%22">Lisa DeBruine</a>, is helpful in that columns don’t have to be manually identified, and is reusable for any survey.</p>
<pre class="r"><code>new_names &lt;- survey %&gt;% 
  t() %&gt;% 
  as_tibble() %&gt;% 
  mutate(name = paste(V1, sep = &quot;_&quot;)) %&gt;% 
  pull(name)

new_names[1:4] &lt;- c(&quot;stakeholder_group&quot;, &quot;gender&quot;, &quot;position&quot;, &quot;sector&quot;)</code></pre>
<p>Which can now be applied to the survey data, and the first row dropped.</p>
<pre class="r"><code>names(survey) &lt;- new_names
survey &lt;- survey[-1,]</code></pre>
<p>There are duplicate columns names which will cause trouble if you want to analyze right away, but they’ll get dealt with in the next step.</p>
</div>
<div id="numeric-and-text-responses-combined" class="section level4">
<h4>2. Numeric and text responses combined</h4>
<p>Separating the quantitative response values from the qualitative is a necessary step for future gathering and tallying responses. The qualitative responses vary in length, and sometimes are their own question, or are an addition to a numeric question.</p>
<p>In this case, the qualitative questions are all the same, there are “Other” categories sometimes used when none of the options are suitable but a response is required. I generally reccommend avoiding these, as the single-value responses like this take longer to analyze and more often than not are closely aligned to one of the options.</p>
<pre class="r"><code>survey_text &lt;- survey %&gt;% 
  setNames(make.unique(names(.))) %&gt;%
  select(stakeholder_group:sector, contains(&quot;Other&quot;))

survey &lt;- survey %&gt;% 
    setNames(make.unique(names(.))) %&gt;%
    select(everything(), -contains(&quot;Other&quot;))</code></pre>
</div>
<div id="removing-the-non-responsive-respondents" class="section level3">
<h3>3. Removing the non-responsive respondents</h3>
<p>Without spending much detail on this, for some reason on the survey export I get all respondents, even those which closed the survey at the beginning. These respondents have <code>NA</code> values for all responses. Any one of the respondent characteristics can be filtered out and removed:</p>
<pre class="r"><code>survey &lt;- survey %&gt;% filter(!is.na(gender))</code></pre>
<p>Now that the data is renamed and cleaned, the tidying and counting can begin!</p>
<div class="figure">
<img src="https://media.giphy.com/media/rt62KfHCCpyP6/giphy.gif" />

</div>
</div>
</div>
<div id="tidying-the-dataset-gather-group-tally-spread" class="section level2">
<h2>Tidying the dataset: gather, group, tally, spread</h2>
<p>The problem with the way the data is presently structured is that each question value has it’s own column (opposed to combined in the same “question” variable column), the current ratings (e.g. good or very good) are text, but we need a count, and there are values where respondents could choose not to answer, giving a <N/A> Value.</p>
<pre class="r"><code>survey_counts &lt;-  survey %&gt;% 
  gather(key = Question, value = Response,
         &quot;1.1 Refugees have been consulted in the design of AGENCY-funded projects&quot;:&quot;1.4 A gender-sensitive needs assessment, or a gender analysis, was undertaken in the design and implementation of interventions&quot;) %&gt;% 
  group_by(stakeholder_group, Question, Response) %&gt;% 
  tally %&gt;% 
  spread(Response, n, fill = 0) %&gt;% 
  select(stakeholder_group, Question,`Strongly disagree`, Disagree, `Do not know/ Not applicable`, Agree,
         `Strongly agree`, no_response = `&lt;NA&gt;`) %&gt;%
  filter(!is.na(stakeholder_group))</code></pre>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-8">Table 1: </span>All respondent values have now been tallied
</caption>
<thead>
<tr>
<th style="text-align:left;">
stakeholder_group
</th>
<th style="text-align:left;">
Question
</th>
<th style="text-align:right;">
Strongly disagree
</th>
<th style="text-align:right;">
Disagree
</th>
<th style="text-align:right;">
Do not know/ Not applicable
</th>
<th style="text-align:right;">
Agree
</th>
<th style="text-align:right;">
Strongly agree
</th>
<th style="text-align:right;">
no_response
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AGENCY
</td>
<td style="text-align:left;">
1.1 Refugees have been consulted in the design of AGENCY-funded projects
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
EU Member State
</td>
<td style="text-align:left;">
1.1 Refugees have been consulted in the design of AGENCY-funded projects
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
INGO
</td>
<td style="text-align:left;">
1.1 Refugees have been consulted in the design of AGENCY-funded projects
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Local NGO
</td>
<td style="text-align:left;">
1.1 Refugees have been consulted in the design of AGENCY-funded projects
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
Other EU
</td>
<td style="text-align:left;">
1.1 Refugees have been consulted in the design of AGENCY-funded projects
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</div>
